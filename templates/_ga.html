{% if jekyll.environment == "production" %}
  <script>
    function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }
    if (getCookie('cookieconsent_status') !== 'allow') {
      FingerprintJS.load().then(fp => {
        fp.get().then(result => {
          var visitorId = result.visitorId;
          var gaProperty = '{{ site.ga_property }}';
          var disableStr = 'ga-disable-' + gaProperty;

          if (document.cookie.indexOf(disableStr + '=true') > -1) {
            window[disableStr] = true;
          }

          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', gaProperty, {
            'storage': 'none',
            'clientId': visitorId
          });
          ga('set', 'anonymizeIp', true);
          ga('send', 'pageview');
        });
      });
    }
  </script>
  <script type="text/plain" data-cookieconsent="accepted">
    var gaProperty = '{{ site.ga_property }}';
    var disableStr = 'ga-disable-' + gaProperty;

    if (document.cookie.indexOf(disableStr + '=true') > -1) {
      window[disableStr] = true;
    }

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', gaProperty, 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
  </script>
{% endif %}